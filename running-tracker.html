<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1976D2">
    <meta name="description" content="JP Morgan Run Training Tracker - Track your 14-week training journey">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Run Tracker">
    <link rel="manifest" href="manifest.json">
    <title>üèÉ‚Äç‚ôÇÔ∏è JP Morgan Run Training</title>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: #F5F5F5;
            color: #212121;
            padding-bottom: 70px;
            -webkit-font-smoothing: antialiased;
        }

        .header {
            background: linear-gradient(135deg, #1976D2 0%, #1565C0 100%);
            color: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header h1 {
            font-size: 20px;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .header .subtitle {
            font-size: 14px;
            opacity: 0.9;
        }

        .content {
            max-width: 600px;
            margin: 0 auto;
            padding: 16px;
        }

        .card {
            background: white;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .card-header {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .badge {
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 12px;
            font-weight: 500;
        }

        .badge.success {
            background: #E8F5E9;
            color: #4CAF50;
        }

        .badge.warning {
            background: #FFF3E0;
            color: #FF9800;
        }

        .countdown-card {
            background: linear-gradient(135deg, #1976D2 0%, #1565C0 100%);
            color: white;
            text-align: center;
            padding: 24px;
        }

        .countdown-number {
            font-size: 48px;
            font-weight: bold;
            margin: 8px 0;
        }

        .countdown-text {
            font-size: 14px;
            opacity: 0.9;
        }

        .race-details {
            font-size: 14px;
            margin-top: 12px;
            opacity: 0.95;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 12px;
        }

        .stat-box {
            background: #F5F5F5;
            padding: 12px;
            border-radius: 6px;
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #1976D2;
        }

        .stat-label {
            font-size: 12px;
            color: #757575;
            margin-top: 4px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #E0E0E0;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 12px;
        }

        .progress-fill {
            height: 100%;
            background: #4CAF50;
            transition: width 0.3s ease;
        }

        .btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
            margin-top: 8px;
        }

        .btn-primary {
            background: #1976D2;
            color: white;
        }

        .btn-primary:active {
            background: #1565C0;
        }

        .btn-secondary {
            background: #E0E0E0;
            color: #212121;
        }

        .btn-secondary:active {
            background: #BDBDBD;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 6px;
            color: #212121;
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #E0E0E0;
            border-radius: 6px;
            font-size: 16px;
            font-family: inherit;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: #1976D2;
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .run-item {
            border-left: 4px solid;
            padding: 12px;
            margin-bottom: 12px;
            background: white;
            border-radius: 4px;
        }

        .run-item.completed {
            border-left-color: #4CAF50;
        }

        .run-item.missed {
            border-left-color: #F44336;
        }

        .run-date {
            font-size: 12px;
            color: #757575;
            margin-bottom: 4px;
        }

        .run-details {
            font-size: 14px;
            margin: 4px 0;
        }

        .run-pace {
            color: #1976D2;
            font-weight: 500;
        }

        .run-notes {
            font-size: 12px;
            color: #757575;
            margin-top: 8px;
        }

        .run-item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 4px;
        }

        .delete-run-btn {
            background: #F44336;
            color: white;
            border: none;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 11px;
            cursor: pointer;
            transition: background 0.2s;
            font-weight: 500;
        }

        .delete-run-btn:active {
            background: #D32F2F;
        }

        .week-filters {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding-bottom: 8px;
            margin-bottom: 16px;
            -webkit-overflow-scrolling: touch;
        }

        .week-filter-btn {
            padding: 8px 16px;
            border: 1px solid #E0E0E0;
            background: white;
            border-radius: 20px;
            font-size: 14px;
            white-space: nowrap;
            cursor: pointer;
            transition: all 0.2s;
        }

        .week-filter-btn.active {
            background: #1976D2;
            color: white;
            border-color: #1976D2;
        }

        .reflection-card {
            background: #FFF9C4;
            border-left: 4px solid #FBC02D;
            padding: 16px;
            margin-bottom: 12px;
            border-radius: 4px;
        }

        .reflection-week {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .reflection-text {
            font-size: 14px;
            margin: 8px 0;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #757575;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 12px;
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #E0E0E0;
            display: flex;
            justify-content: space-around;
            padding: 8px 0;
            box-shadow: 0 -2px 4px rgba(0,0,0,0.1);
        }

        .nav-item {
            flex: 1;
            text-align: center;
            padding: 8px;
            color: #757575;
            text-decoration: none;
            cursor: pointer;
            transition: color 0.2s;
        }

        .nav-item.active {
            color: #1976D2;
        }

        .nav-icon {
            font-size: 24px;
            display: block;
            margin-bottom: 4px;
        }

        .nav-icon.log-icon {
            color: #ff4757;
            font-weight: bold;
        }

        .nav-label {
            font-size: 11px;
            display: block;
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        .conditional-fields {
            display: none;
        }

        .conditional-fields.visible {
            display: block;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .checkbox-label input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .today-workout {
            background: #E3F2FD;
            padding: 12px;
            border-radius: 6px;
            margin-top: 8px;
        }

        .today-workout-label {
            font-size: 12px;
            color: #757575;
            margin-bottom: 4px;
        }

        .today-workout-details {
            font-size: 14px;
            font-weight: 500;
            color: #1976D2;
        }

        .week-accordion {
            margin-bottom: 12px;
        }

        .week-header {
            background: white;
            padding: 16px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            transition: background 0.2s;
        }

        .week-header:active {
            background: #F5F5F5;
        }

        .week-header.current {
            background: #E3F2FD;
            border-left: 4px solid #1976D2;
        }

        .week-title {
            font-size: 16px;
            font-weight: 500;
        }

        .week-subtitle {
            font-size: 12px;
            color: #757575;
            margin-top: 2px;
        }

        .week-arrow {
            font-size: 20px;
            transition: transform 0.3s;
        }

        .week-arrow.expanded {
            transform: rotate(90deg);
        }

        .week-content {
            display: none;
            background: white;
            padding: 16px;
            margin-top: -8px;
            border-radius: 0 0 8px 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .week-content.visible {
            display: block;
        }

        .plan-run-item {
            padding: 12px;
            margin-bottom: 8px;
            background: #F5F5F5;
            border-radius: 6px;
            border-left: 3px solid #1976D2;
            position: relative;
        }

        .plan-run-item.completed {
            background: #E8F5E9;
            border-left-color: #4CAF50;
        }

        .plan-run-item.missed {
            background: #FFEBEE;
            border-left-color: #F44336;
            opacity: 0.7;
        }

        .plan-day {
            font-size: 12px;
            font-weight: 500;
            color: #1976D2;
            margin-bottom: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .plan-workout {
            font-size: 14px;
            margin-bottom: 4px;
        }

        .plan-pace {
            font-size: 12px;
            color: #757575;
        }

        .run-status {
            font-size: 16px;
        }

        .actual-pace {
            font-size: 11px;
            color: #4CAF50;
            font-weight: 500;
            margin-top: 4px;
        }

        .week-completion {
            font-size: 11px;
            font-weight: 500;
            margin-top: 4px;
        }

        .week-completion.complete {
            color: #4CAF50;
        }

        .week-completion.partial {
            color: #FF9800;
        }

        .week-completion.none {
            color: #757575;
        }

        .phase-badge {
            display: inline-block;
            font-size: 11px;
            padding: 3px 8px;
            border-radius: 10px;
            background: #E0E0E0;
            color: #616161;
            margin-left: 8px;
        }

        .phase-badge.phase-1 {
            background: #C8E6C9;
            color: #2E7D32;
        }

        .phase-badge.phase-2 {
            background: #FFECB3;
            color: #F57F17;
        }

        .phase-badge.phase-3 {
            background: #FFCCBC;
            color: #D84315;
        }

        .phase-badge.phase-4 {
            background: #F8BBD0;
            color: #C2185B;
        }

        .chart-container {
            margin: 20px 0;
            padding: 16px;
            background: white;
            border-radius: 8px;
        }

        .chart-title {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 16px;
            color: #212121;
        }

        .bar-chart {
            display: flex;
            align-items: flex-end;
            height: 200px;
            gap: 4px;
            margin-top: 12px;
            padding: 12px 0;
            border-bottom: 2px solid #E0E0E0;
        }

        .bar-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
        }

        .bar {
            width: 100%;
            background: linear-gradient(to top, #1976D2, #42A5F5);
            border-radius: 4px 4px 0 0;
            transition: all 0.3s;
            min-height: 4px;
        }

        .bar-label {
            font-size: 10px;
            color: #757575;
            margin-top: 8px;
            text-align: center;
        }

        .bar-value {
            font-size: 10px;
            font-weight: 500;
            color: #1976D2;
            margin-bottom: 4px;
        }

        .line-chart {
            position: relative;
            height: 200px;
            margin-top: 12px;
            padding: 12px 0;
            border-bottom: 2px solid #E0E0E0;
        }

        .line-chart-svg {
            width: 100%;
            height: 100%;
        }

        .stat-card {
            background: #F5F5F5;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 12px;
        }

        .stat-card-title {
            font-size: 12px;
            color: #757575;
            margin-bottom: 4px;
        }

        .stat-card-value {
            font-size: 24px;
            font-weight: bold;
            color: #1976D2;
        }

        .stat-card-subtitle {
            font-size: 12px;
            color: #757575;
            margin-top: 4px;
        }

        .analytics-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 16px;
        }

        .chart-legend {
            display: flex;
            gap: 16px;
            margin-top: 12px;
            font-size: 12px;
            color: #757575;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <h1>üèÉ‚Äç‚ôÇÔ∏è JP Morgan Run Training</h1>
        <div class="subtitle" id="header-subtitle">Week 1 of 14 ‚Ä¢ 0 days to race</div>
    </div>

    <!-- Dashboard Screen -->
    <div id="dashboard-screen" class="screen active">
        <div class="content">
            <!-- Race Countdown Card -->
            <div class="card countdown-card">
                <div class="countdown-text">Days Until Race</div>
                <div class="countdown-number" id="days-to-race">0</div>
                <div class="race-details">April 16, 2026 ‚Ä¢ 5.6km ‚Ä¢ Target: 29:45</div>
            </div>

            <!-- This Week Progress Card -->
            <div class="card">
                <div class="card-header">
                    <span id="week-progress-title">Week 1 Progress</span>
                    <span class="badge success" id="week-progress-badge">On Track</span>
                </div>
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-value" id="week-runs-completed">0/4</div>
                        <div class="stat-label">Runs Completed</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="week-progress-percent">0%</div>
                        <div class="stat-label">Week Progress</div>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="week-progress-bar" style="width: 0%"></div>
                </div>
            </div>

            <!-- Overall Training Stats Card -->
            <div class="card">
                <div class="card-header">Overall Training Stats</div>
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-value" id="total-runs">0</div>
                        <div class="stat-label">Total Runs</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="total-km">0.0</div>
                        <div class="stat-label">Total KM</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="avg-pace">--</div>
                        <div class="stat-label">Avg Pace</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="day-streak">0</div>
                        <div class="stat-label">Day Streak</div>
                    </div>
                </div>
            </div>

            <!-- Quick Log Today Card -->
            <div class="card">
                <div class="card-header">Quick Log Today</div>
                <div style="font-size: 14px; color: #757575; margin-bottom: 8px;" id="today-date">Today</div>
                <div class="today-workout" id="today-workout-display">
                    <div class="today-workout-label">Today's Workout</div>
                    <div class="today-workout-details" id="today-workout-text">Rest Day</div>
                    <div class="today-workout-label" style="margin-top: 8px;">Target Pace</div>
                    <div class="today-workout-details" id="today-pace-text">--</div>
                </div>
                <button class="btn btn-primary" onclick="switchScreen('log')">Log Today's Run</button>
            </div>
        </div>
    </div>

    <!-- Log Run Screen -->
    <div id="log-screen" class="screen">
        <div class="content">
            <div class="card">
                <div class="card-header">Log Your Run</div>

                <form id="run-form">
                    <div class="form-group">
                        <label class="form-label">Date</label>
                        <input type="date" id="log-date" class="form-input" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Did you complete this run?</label>
                        <select id="log-completed" class="form-select" required>
                            <option value="">Select...</option>
                            <option value="yes">‚úÖ Yes, completed</option>
                            <option value="no">‚ùå No, missed it</option>
                        </select>
                    </div>

                    <div id="completed-fields" class="conditional-fields">
                        <div class="form-group">
                            <label class="form-label">Duration (minutes)</label>
                            <input type="number" id="log-duration" class="form-input" min="1" step="0.1" placeholder="e.g., 15">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Distance (km)</label>
                            <input type="number" id="log-distance" class="form-input" min="0.1" step="0.1" placeholder="e.g., 2.5">
                        </div>

                        <div class="form-group">
                            <label class="form-label">How did it feel?</label>
                            <select id="log-feeling" class="form-select">
                                <option value="great">üòä Great - felt strong</option>
                                <option value="good" selected>üôÇ Good - solid run</option>
                                <option value="okay">üòê Okay - got through it</option>
                                <option value="tough">üòì Tough - struggled</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Notes (optional)</label>
                            <textarea id="log-notes" class="form-textarea" placeholder="Weather, energy level, any issues..."></textarea>
                        </div>
                    </div>

                    <div id="missed-fields" class="conditional-fields">
                        <div class="form-group">
                            <label class="form-label">Why did you miss it? (optional)</label>
                            <textarea id="log-missed-reason" class="form-textarea" placeholder="Be honest - it helps you learn..."></textarea>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary">Save Run</button>
                    <button type="button" class="btn btn-secondary" onclick="switchScreen('dashboard')">Cancel</button>
                </form>
            </div>
        </div>
    </div>

    <!-- History Screen -->
    <div id="history-screen" class="screen">
        <div class="content">
            <div class="week-filters" id="week-filters">
                <button class="week-filter-btn active" onclick="filterHistory('all')">All</button>
                <!-- Week buttons will be generated dynamically -->
            </div>

            <div id="history-list">
                <div class="empty-state">
                    <div class="empty-state-icon">üèÉ‚Äç‚ôÇÔ∏è</div>
                    <div>No runs logged yet</div>
                    <div style="font-size: 12px; margin-top: 8px;">Start tracking your training!</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Reflections Screen -->
    <div id="reflect-screen" class="screen">
        <div class="content">
            <div class="card">
                <div class="card-header">Weekly Reflection</div>

                <form id="reflection-form">
                    <div class="form-group">
                        <label class="form-label">Week</label>
                        <select id="reflection-week" class="form-select">
                            <!-- Week options will be generated dynamically -->
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="reflection-bedtime">
                            <span>I maintained good bedtime discipline (in bed by 10:30pm)</span>
                        </label>
                    </div>

                    <div class="form-group">
                        <label class="form-label">What almost stopped me?</label>
                        <textarea id="reflection-almost-stopped" class="form-textarea" placeholder="Weather, tiredness, work stress..."></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">What worked well?</label>
                        <textarea id="reflection-worked-well" class="form-textarea" placeholder="Morning routine, support from Srishti, good playlist..."></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Overall week rating</label>
                        <select id="reflection-rating" class="form-select">
                            <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Excellent</option>
                            <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê Good</option>
                            <option value="3" selected>‚≠ê‚≠ê‚≠ê Average</option>
                            <option value="2">‚≠ê‚≠ê Below Average</option>
                            <option value="1">‚≠ê Poor</option>
                        </select>
                    </div>

                    <button type="submit" class="btn btn-primary">Save Reflection</button>
                </form>
            </div>

            <div class="card-header" style="margin-top: 16px; margin-bottom: 12px;">Past Reflections</div>
            <div id="past-reflections">
                <div class="empty-state">
                    <div class="empty-state-icon">üí≠</div>
                    <div>No reflections yet</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Plan Screen -->
    <div id="plan-screen" class="screen">
        <div class="content">
            <div class="card">
                <div class="card-header">14-Week Training Plan</div>
                <div style="font-size: 14px; color: #757575; margin-top: 8px; margin-bottom: 12px;">
                    Tap any week to see the scheduled runs
                </div>
                <div id="overall-progress">
                    <!-- Overall progress will be shown here -->
                </div>
            </div>

            <div id="plan-accordion">
                <!-- Weeks will be generated dynamically -->
            </div>
        </div>
    </div>

    <!-- Analytics Screen -->
    <div id="analytics-screen" class="screen">
        <div class="content">
            <div class="card">
                <div class="card-header">Training Analytics</div>
                <div style="font-size: 14px; color: #757575; margin-top: 8px;">
                    Visual insights into your training progress
                </div>
            </div>

            <!-- Summary Stats -->
            <div class="analytics-grid">
                <div class="stat-card">
                    <div class="stat-card-title">Fastest Pace</div>
                    <div class="stat-card-value" id="fastest-pace">--</div>
                    <div class="stat-card-subtitle">min/km</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-title">Slowest Pace</div>
                    <div class="stat-card-value" id="slowest-pace">--</div>
                    <div class="stat-card-subtitle">min/km</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-title">Total Distance</div>
                    <div class="stat-card-value" id="total-distance-analytics">0</div>
                    <div class="stat-card-subtitle">kilometers</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-title">Total Time</div>
                    <div class="stat-card-value" id="total-time-analytics">0</div>
                    <div class="stat-card-subtitle">minutes</div>
                </div>
            </div>

            <!-- Pace Trend Chart -->
            <div class="chart-container">
                <div class="chart-title">Pace Trend (Last 10 Runs)</div>
                <div id="pace-trend-chart" class="line-chart">
                    <div class="empty-state">
                        <div class="empty-state-icon">üìà</div>
                        <div style="font-size: 14px;">Complete at least 2 runs to see pace trends</div>
                    </div>
                </div>
            </div>

            <!-- Weekly Volume Chart -->
            <div class="chart-container">
                <div class="chart-title">Weekly Running Volume (km)</div>
                <div id="weekly-volume-chart" class="bar-chart">
                    <div class="empty-state">
                        <div class="empty-state-icon">üìä</div>
                        <div style="font-size: 14px;">Start logging runs to see weekly volume</div>
                    </div>
                </div>
            </div>

            <!-- Weekly Run Count Chart -->
            <div class="chart-container">
                <div class="chart-title">Runs Per Week</div>
                <div id="weekly-runs-chart" class="bar-chart">
                    <div class="empty-state">
                        <div class="empty-state-icon">üèÉ‚Äç‚ôÇÔ∏è</div>
                        <div style="font-size: 14px;">Start logging runs to see weekly counts</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <div class="nav-item active" onclick="switchScreen('dashboard')">
            <span class="nav-icon">üè†</span>
            <span class="nav-label">Home</span>
        </div>
        <div class="nav-item" onclick="switchScreen('plan')">
            <span class="nav-icon">üìÖ</span>
            <span class="nav-label">Plan</span>
        </div>
        <div class="nav-item" onclick="switchScreen('log')">
            <span class="nav-icon log-icon">‚ûï</span>
            <span class="nav-label">Log</span>
        </div>
        <div class="nav-item" onclick="switchScreen('analytics')">
            <span class="nav-icon">üìà</span>
            <span class="nav-label">Analytics</span>
        </div>
        <div class="nav-item" onclick="switchScreen('history')">
            <span class="nav-icon">üìú</span>
            <span class="nav-label">History</span>
        </div>
        <div class="nav-item" onclick="switchScreen('reflect')">
            <span class="nav-icon">üí≠</span>
            <span class="nav-label">Reflect</span>
        </div>
    </div>

    <script>
        // Training Plan Data
        const TRAINING_PLAN = {
            1: [
                {day: 'Monday', workout: '15 min easy', targetPace: '6:30-7:00/km'},
                {day: 'Wednesday', workout: '12 min easy', targetPace: '6:30-7:00/km'},
                {day: 'Friday', workout: '15 min easy', targetPace: '6:30-7:00/km'},
                {day: 'Sunday', workout: '20 min easy', targetPace: '6:30-7:00/km'}
            ],
            2: [
                {day: 'Monday', workout: '18 min easy', targetPace: '6:30-7:00/km'},
                {day: 'Wednesday', workout: '15 min easy', targetPace: '6:30-7:00/km'},
                {day: 'Friday', workout: '18 min easy', targetPace: '6:30-7:00/km'},
                {day: 'Sunday', workout: '25 min easy', targetPace: '6:30-7:00/km'}
            ],
            3: [
                {day: 'Monday', workout: '20 min easy', targetPace: '6:30-7:00/km'},
                {day: 'Wednesday', workout: '15 min easy + 4x(1 min faster, 1 min jog recovery)', targetPace: '6:30-7:00/km'},
                {day: 'Friday', workout: '20 min easy', targetPace: '6:30-7:00/km'},
                {day: 'Sunday', workout: '30 min easy', targetPace: '6:30-7:00/km'}
            ],
            4: [
                {day: 'Monday', workout: '20 min easy', targetPace: '6:30-7:00/km'},
                {day: 'Wednesday', workout: '15 min easy', targetPace: '6:30-7:00/km'},
                {day: 'Friday', workout: 'Rest or 15 min easy walk', targetPace: '--'},
                {day: 'Sunday', workout: '25 min easy', targetPace: '6:30-7:00/km'}
            ],
            5: [
                {day: 'Monday', workout: '25 min easy', targetPace: '6:15-6:45/km'},
                {day: 'Wednesday', workout: 'TEMPO - 10 min easy + 10 min at 5:50/km + 5 min easy', targetPace: '5:40-5:50/km'},
                {day: 'Friday', workout: '20 min easy', targetPace: '6:15-6:45/km'},
                {day: 'Sunday', workout: '35 min easy', targetPace: '6:15-6:45/km'}
            ],
            6: [
                {day: 'Monday', workout: '25 min easy', targetPace: '6:15-6:45/km'},
                {day: 'Wednesday', workout: 'INTERVALS - 10 min easy + 6x(2 min at 5:30/km, 90 sec jog) + 5 min easy', targetPace: '5:10-5:30/km'},
                {day: 'Friday', workout: '20 min easy', targetPace: '6:15-6:45/km'},
                {day: 'Sunday', workout: '35 min easy', targetPace: '6:15-6:45/km'}
            ],
            7: [
                {day: 'Monday', workout: '25 min easy', targetPace: '6:15-6:45/km'},
                {day: 'Wednesday', workout: 'TEMPO - 10 min easy + 12 min at 5:45/km + 5 min easy', targetPace: '5:40-5:50/km'},
                {day: 'Friday', workout: '20 min easy', targetPace: '6:15-6:45/km'},
                {day: 'Sunday', workout: '40 min easy', targetPace: '6:15-6:45/km'}
            ],
            8: [
                {day: 'Monday', workout: '25 min easy', targetPace: '6:15-6:45/km'},
                {day: 'Wednesday', workout: 'INTERVALS - 10 min easy + 5x(3 min at 5:25/km, 90 sec jog) + 5 min easy', targetPace: '5:10-5:30/km'},
                {day: 'Friday', workout: '20 min easy', targetPace: '6:15-6:45/km'},
                {day: 'Sunday', workout: '40 min easy', targetPace: '6:15-6:45/km'}
            ],
            9: [
                {day: 'Monday', workout: '25 min easy', targetPace: '6:15-6:45/km'},
                {day: 'Wednesday', workout: '20 min easy + 5x(30 sec fast, 90 sec easy)', targetPace: '6:15-6:45/km'},
                {day: 'Friday', workout: 'Rest or easy walk', targetPace: '--'},
                {day: 'Sunday', workout: '30 min easy', targetPace: '6:15-6:45/km'}
            ],
            10: [
                {day: 'Monday', workout: '25 min easy', targetPace: '6:15-6:45/km'},
                {day: 'Wednesday', workout: 'RACE PACE - 10 min easy + 5x(800m at 5:20/km, 400m jog) + 5 min easy', targetPace: '5:20/km'},
                {day: 'Friday', workout: '20 min easy', targetPace: '6:15-6:45/km'},
                {day: 'Sunday', workout: '35 min easy', targetPace: '6:15-6:45/km'}
            ],
            11: [
                {day: 'Monday', workout: '25 min easy', targetPace: '6:15-6:45/km'},
                {day: 'Wednesday', workout: 'SPEED - 10 min easy + 8x(400m at 5:10/km, 200m jog) + 5 min easy', targetPace: '5:10/km'},
                {day: 'Friday', workout: '20 min easy', targetPace: '6:15-6:45/km'},
                {day: 'Sunday', workout: '35 min easy', targetPace: '6:15-6:45/km'}
            ],
            12: [
                {day: 'Monday', workout: '25 min easy', targetPace: '6:15-6:45/km'},
                {day: 'Wednesday', workout: 'RACE PACE - 10 min easy + 20 min at 5:20/km + 5 min easy', targetPace: '5:20/km'},
                {day: 'Friday', workout: '20 min easy', targetPace: '6:15-6:45/km'},
                {day: 'Sunday', workout: '30 min easy', targetPace: '6:15-6:45/km'}
            ],
            13: [
                {day: 'Monday', workout: '25 min easy', targetPace: '6:15-6:45/km'},
                {day: 'Wednesday', workout: 'SHARPENER - 10 min easy + 4x(1km at 5:15/km, 2 min jog) + 5 min easy', targetPace: '5:15/km'},
                {day: 'Friday', workout: '20 min easy', targetPace: '6:15-6:45/km'},
                {day: 'Sunday', workout: '30 min easy', targetPace: '6:15-6:45/km'}
            ],
            14: [
                {day: 'Monday', workout: '20 min easy', targetPace: '6:15-6:45/km'},
                {day: 'Wednesday', workout: '15 min easy + 3x(2 min at race pace, 2 min jog)', targetPace: '5:20/km'},
                {day: 'Friday', workout: 'COMPLETE REST', targetPace: '--'},
                {day: 'Saturday', workout: 'RACE DAY üèÅ', targetPace: '5:20/km'}
            ]
        };

        // Constants
        const RACE_DATE = new Date('2026-04-16');
        const START_DATE = new Date('2026-01-13');

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            init();
        });

        function init() {
            // Set today's date in form
            document.getElementById('log-date').valueAsDate = new Date();

            // Populate week selector
            const reflectionWeek = document.getElementById('reflection-week');
            for (let i = 1; i <= 14; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = `Week ${i}`;
                reflectionWeek.appendChild(option);
            }

            // Set current week in reflection selector
            const currentWeek = getCurrentWeek();
            reflectionWeek.value = currentWeek;

            // Generate week filter buttons
            const weekFilters = document.getElementById('week-filters');
            for (let i = 1; i <= 14; i++) {
                const btn = document.createElement('button');
                btn.className = 'week-filter-btn';
                btn.textContent = `Week ${i}`;
                btn.onclick = () => filterHistory(i);
                weekFilters.appendChild(btn);
            }

            // Setup form handlers
            document.getElementById('log-completed').addEventListener('change', toggleConditionalFields);
            document.getElementById('run-form').addEventListener('submit', saveRun);
            document.getElementById('reflection-form').addEventListener('submit', saveReflection);
            document.getElementById('reflection-week').addEventListener('change', loadReflection);

            // Update dashboard
            updateDashboard();
            updateHistory();
            updateReflections();
            generateTrainingPlan();

            // Load saved reflection if exists
            loadReflection();
        }

        function getCurrentWeek() {
            const today = new Date();
            const diffTime = today - START_DATE;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            const week = Math.ceil(diffDays / 7);
            return Math.max(1, Math.min(14, week));
        }

        function getDaysToRace() {
            const today = new Date();
            const diffTime = RACE_DATE - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return Math.max(0, diffDays);
        }

        function getWeekFromDate(dateStr) {
            const date = new Date(dateStr);
            const diffTime = date - START_DATE;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            const week = Math.ceil(diffDays / 7);
            return Math.max(1, Math.min(14, week));
        }

        function calculatePace(durationMins, distanceKm) {
            if (!durationMins || !distanceKm) return null;
            return (durationMins * 60) / distanceKm; // seconds per km
        }

        function formatPace(seconds) {
            if (!seconds) return '--';
            const mins = Math.floor(seconds / 60);
            const secs = Math.round(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        function getTodayWorkout() {
            const today = new Date();
            const dayName = today.toLocaleDateString('en-US', { weekday: 'long' });
            const currentWeek = getCurrentWeek();
            const weekPlan = TRAINING_PLAN[currentWeek];

            if (!weekPlan) return null;

            return weekPlan.find(w => w.day === dayName);
        }

        function switchScreen(screenName) {
            // Hide all screens
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));

            // Show selected screen
            document.getElementById(screenName + '-screen').classList.add('active');

            // Update nav active state
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            const navItems = document.querySelectorAll('.nav-item');
            const screenMap = ['dashboard', 'plan', 'log', 'analytics', 'history', 'reflect'];
            const index = screenMap.indexOf(screenName);
            if (index >= 0) navItems[index].classList.add('active');

            // Update data when switching to screens
            if (screenName === 'dashboard') updateDashboard();
            if (screenName === 'plan') generateTrainingPlan();
            if (screenName === 'analytics') updateAnalytics();
            if (screenName === 'history') updateHistory();
            if (screenName === 'reflect') updateReflections();
        }

        function toggleConditionalFields() {
            const completed = document.getElementById('log-completed').value;
            const completedFields = document.getElementById('completed-fields');
            const missedFields = document.getElementById('missed-fields');

            if (completed === 'yes') {
                completedFields.classList.add('visible');
                missedFields.classList.remove('visible');
                document.getElementById('log-duration').required = true;
                document.getElementById('log-distance').required = true;
            } else if (completed === 'no') {
                completedFields.classList.remove('visible');
                missedFields.classList.add('visible');
                document.getElementById('log-duration').required = false;
                document.getElementById('log-distance').required = false;
            } else {
                completedFields.classList.remove('visible');
                missedFields.classList.remove('visible');
            }
        }

        function saveRun(e) {
            e.preventDefault();

            const date = document.getElementById('log-date').value;
            const completed = document.getElementById('log-completed').value === 'yes';
            const duration = parseFloat(document.getElementById('log-duration').value) || 0;
            const distance = parseFloat(document.getElementById('log-distance').value) || 0;
            const feeling = document.getElementById('log-feeling').value;
            const notes = document.getElementById('log-notes').value;
            const missedReason = document.getElementById('log-missed-reason').value;

            const run = {
                id: Date.now(),
                date: date,
                week: getWeekFromDate(date),
                completed: completed,
                duration: duration,
                distance: distance,
                pace: calculatePace(duration, distance),
                feeling: feeling,
                notes: notes,
                missedReason: missedReason
            };

            // Get existing runs
            let runs = JSON.parse(localStorage.getItem('runs') || '[]');
            runs.push(run);
            localStorage.setItem('runs', JSON.stringify(runs));

            // Reset form
            document.getElementById('run-form').reset();
            document.getElementById('log-date').valueAsDate = new Date();
            toggleConditionalFields();

            // Show success and return to dashboard
            alert('Run saved successfully!');
            switchScreen('dashboard');
        }

        function saveReflection(e) {
            e.preventDefault();

            const week = parseInt(document.getElementById('reflection-week').value);
            const bedtime = document.getElementById('reflection-bedtime').checked;
            const almostStopped = document.getElementById('reflection-almost-stopped').value;
            const workedWell = document.getElementById('reflection-worked-well').value;
            const rating = document.getElementById('reflection-rating').value;

            const reflection = {
                week: week,
                bedtime: bedtime,
                almostStopped: almostStopped,
                workedWell: workedWell,
                rating: rating,
                timestamp: new Date().toISOString()
            };

            // Get existing reflections
            let reflections = JSON.parse(localStorage.getItem('reflections') || '[]');

            // Remove existing reflection for this week if any
            reflections = reflections.filter(r => r.week !== week);

            // Add new reflection
            reflections.push(reflection);
            localStorage.setItem('reflections', JSON.stringify(reflections));

            // Show success
            alert('Reflection saved successfully!');

            // Update display
            updateReflections();
        }

        function loadReflection() {
            const week = parseInt(document.getElementById('reflection-week').value);
            const reflections = JSON.parse(localStorage.getItem('reflections') || '[]');
            const reflection = reflections.find(r => r.week === week);

            if (reflection) {
                document.getElementById('reflection-bedtime').checked = reflection.bedtime;
                document.getElementById('reflection-almost-stopped').value = reflection.almostStopped;
                document.getElementById('reflection-worked-well').value = reflection.workedWell;
                document.getElementById('reflection-rating').value = reflection.rating;
            } else {
                document.getElementById('reflection-bedtime').checked = false;
                document.getElementById('reflection-almost-stopped').value = '';
                document.getElementById('reflection-worked-well').value = '';
                document.getElementById('reflection-rating').value = '3';
            }
        }

        function updateDashboard() {
            const currentWeek = getCurrentWeek();
            const daysToRace = getDaysToRace();
            const runs = JSON.parse(localStorage.getItem('runs') || '[]');

            // Update header
            document.getElementById('header-subtitle').textContent = `Week ${currentWeek} of 14 ‚Ä¢ ${daysToRace} days to race`;

            // Update countdown
            document.getElementById('days-to-race').textContent = daysToRace;

            // Update today's date and workout
            const today = new Date();
            document.getElementById('today-date').textContent = today.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' });

            const todayWorkout = getTodayWorkout();
            if (todayWorkout) {
                document.getElementById('today-workout-text').textContent = todayWorkout.workout;
                document.getElementById('today-pace-text').textContent = todayWorkout.targetPace;
            } else {
                document.getElementById('today-workout-text').textContent = 'Rest Day';
                document.getElementById('today-pace-text').textContent = '--';
            }

            // Calculate week progress
            const weekRuns = runs.filter(r => r.week === currentWeek && r.completed);
            const weekProgress = (weekRuns.length / 4) * 100;
            document.getElementById('week-progress-title').textContent = `Week ${currentWeek} Progress`;
            document.getElementById('week-runs-completed').textContent = `${weekRuns.length}/4`;
            document.getElementById('week-progress-percent').textContent = `${Math.round(weekProgress)}%`;
            document.getElementById('week-progress-bar').style.width = `${weekProgress}%`;

            // Update badge
            const badge = document.getElementById('week-progress-badge');
            if (weekProgress >= 75) {
                badge.textContent = 'On Track';
                badge.className = 'badge success';
            } else {
                badge.textContent = 'Need Focus';
                badge.className = 'badge warning';
            }

            // Calculate overall stats
            const completedRuns = runs.filter(r => r.completed);
            const totalRuns = completedRuns.length;
            const totalKm = completedRuns.reduce((sum, r) => sum + (r.distance || 0), 0);
            const avgPace = completedRuns.length > 0
                ? completedRuns.reduce((sum, r) => sum + (r.pace || 0), 0) / completedRuns.length
                : 0;
            const streak = calculateStreak(runs);

            document.getElementById('total-runs').textContent = totalRuns;
            document.getElementById('total-km').textContent = totalKm.toFixed(1);
            document.getElementById('avg-pace').textContent = formatPace(avgPace);
            document.getElementById('day-streak').textContent = streak;
        }

        function calculateStreak(runs) {
            if (runs.length === 0) return 0;

            const completedRuns = runs.filter(r => r.completed).sort((a, b) => new Date(b.date) - new Date(a.date));
            if (completedRuns.length === 0) return 0;

            let streak = 0;
            let currentDate = new Date();
            currentDate.setHours(0, 0, 0, 0);

            // Check if there's a run today or yesterday (grace period)
            const mostRecent = new Date(completedRuns[0].date);
            const diffDays = Math.floor((currentDate - mostRecent) / (1000 * 60 * 60 * 24));

            if (diffDays > 2) return 0; // Streak broken if more than 2 days

            // Count consecutive days with runs (allowing 1-day gaps)
            let lastDate = null;
            for (const run of completedRuns) {
                const runDate = new Date(run.date);
                if (lastDate === null) {
                    streak = 1;
                    lastDate = runDate;
                } else {
                    const gap = Math.floor((lastDate - runDate) / (1000 * 60 * 60 * 24));
                    if (gap <= 2) { // Allow 1-day gaps
                        streak++;
                        lastDate = runDate;
                    } else {
                        break;
                    }
                }
            }

            return streak;
        }

        function updateHistory() {
            const runs = JSON.parse(localStorage.getItem('runs') || '[]');
            const historyList = document.getElementById('history-list');

            if (runs.length === 0) {
                historyList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üèÉ‚Äç‚ôÇÔ∏è</div>
                        <div>No runs logged yet</div>
                        <div style="font-size: 12px; margin-top: 8px;">Start tracking your training!</div>
                    </div>
                `;
                return;
            }

            // Sort by date (newest first)
            const sortedRuns = runs.sort((a, b) => new Date(b.date) - new Date(a.date));

            historyList.innerHTML = sortedRuns.map(run => {
                const date = new Date(run.date);
                const dateStr = date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });

                if (run.completed) {
                    const feeling = {
                        'great': 'üòä Great',
                        'good': 'üôÇ Good',
                        'okay': 'üòê Okay',
                        'tough': 'üòì Tough'
                    }[run.feeling] || '';

                    return `
                        <div class="run-item completed">
                            <div class="run-item-header">
                                <div class="run-date">Week ${run.week} ‚Ä¢ ${dateStr}</div>
                                <button class="delete-run-btn" onclick="deleteRun(${run.id})">Delete</button>
                            </div>
                            <div class="run-details">${run.distance}km ‚Ä¢ ${run.duration} min ‚Ä¢ ${feeling}</div>
                            <div class="run-pace">Pace: ${formatPace(run.pace)}/km</div>
                            ${run.notes ? `<div class="run-notes">${run.notes}</div>` : ''}
                        </div>
                    `;
                } else {
                    return `
                        <div class="run-item missed">
                            <div class="run-item-header">
                                <div class="run-date">Week ${run.week} ‚Ä¢ ${dateStr}</div>
                                <button class="delete-run-btn" onclick="deleteRun(${run.id})">Delete</button>
                            </div>
                            <div class="run-details">‚ùå Missed run</div>
                            ${run.missedReason ? `<div class="run-notes">${run.missedReason}</div>` : ''}
                        </div>
                    `;
                }
            }).join('');
        }

        function filterHistory(week) {
            const runs = JSON.parse(localStorage.getItem('runs') || '[]');
            const historyList = document.getElementById('history-list');

            // Update active button
            document.querySelectorAll('.week-filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            let filteredRuns = runs;
            if (week !== 'all') {
                filteredRuns = runs.filter(r => r.week === week);
            }

            if (filteredRuns.length === 0) {
                historyList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üèÉ‚Äç‚ôÇÔ∏è</div>
                        <div>No runs for this week</div>
                    </div>
                `;
                return;
            }

            // Sort by date (newest first)
            const sortedRuns = filteredRuns.sort((a, b) => new Date(b.date) - new Date(a.date));

            historyList.innerHTML = sortedRuns.map(run => {
                const date = new Date(run.date);
                const dateStr = date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });

                if (run.completed) {
                    const feeling = {
                        'great': 'üòä Great',
                        'good': 'üôÇ Good',
                        'okay': 'üòê Okay',
                        'tough': 'üòì Tough'
                    }[run.feeling] || '';

                    return `
                        <div class="run-item completed">
                            <div class="run-item-header">
                                <div class="run-date">Week ${run.week} ‚Ä¢ ${dateStr}</div>
                                <button class="delete-run-btn" onclick="deleteRun(${run.id})">Delete</button>
                            </div>
                            <div class="run-details">${run.distance}km ‚Ä¢ ${run.duration} min ‚Ä¢ ${feeling}</div>
                            <div class="run-pace">Pace: ${formatPace(run.pace)}/km</div>
                            ${run.notes ? `<div class="run-notes">${run.notes}</div>` : ''}
                        </div>
                    `;
                } else {
                    return `
                        <div class="run-item missed">
                            <div class="run-item-header">
                                <div class="run-date">Week ${run.week} ‚Ä¢ ${dateStr}</div>
                                <button class="delete-run-btn" onclick="deleteRun(${run.id})">Delete</button>
                            </div>
                            <div class="run-details">‚ùå Missed run</div>
                            ${run.missedReason ? `<div class="run-notes">${run.missedReason}</div>` : ''}
                        </div>
                    `;
                }
            }).join('');
        }

        function deleteRun(runId) {
            // Confirm deletion
            if (!confirm('Are you sure you want to delete this run? This cannot be undone.')) {
                return;
            }

            // Get current runs
            let runs = JSON.parse(localStorage.getItem('runs') || '[]');

            // Filter out the run to delete
            runs = runs.filter(r => r.id !== runId);

            // Save back to localStorage
            localStorage.setItem('runs', JSON.stringify(runs));

            // Update all views
            updateHistory();
            updateDashboard();
            generateTrainingPlan();

            // Show confirmation
            alert('Run deleted successfully!');
        }

        function updateReflections() {
            const reflections = JSON.parse(localStorage.getItem('reflections') || '[]');
            const pastReflections = document.getElementById('past-reflections');

            if (reflections.length === 0) {
                pastReflections.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üí≠</div>
                        <div>No reflections yet</div>
                    </div>
                `;
                return;
            }

            // Sort by week (newest first)
            const sortedReflections = reflections.sort((a, b) => b.week - a.week);

            pastReflections.innerHTML = sortedReflections.map(r => {
                const stars = '‚≠ê'.repeat(parseInt(r.rating));
                return `
                    <div class="reflection-card">
                        <div class="reflection-week">Week ${r.week} ‚Ä¢ ${stars}</div>
                        ${r.bedtime ? '<div class="reflection-text">‚úÖ Good bedtime discipline</div>' : ''}
                        ${r.almostStopped ? `<div class="reflection-text"><strong>Almost stopped:</strong> ${r.almostStopped}</div>` : ''}
                        ${r.workedWell ? `<div class="reflection-text"><strong>Worked well:</strong> ${r.workedWell}</div>` : ''}
                    </div>
                `;
            }).join('');
        }

        function generateTrainingPlan() {
            const planAccordion = document.getElementById('plan-accordion');
            const overallProgress = document.getElementById('overall-progress');
            const currentWeek = getCurrentWeek();
            const runs = JSON.parse(localStorage.getItem('runs') || '[]');

            // Calculate overall progress
            const totalScheduled = 56; // 14 weeks * 4 runs per week
            const completedRuns = runs.filter(r => r.completed);
            const overallCompletion = Math.round((completedRuns.length / totalScheduled) * 100);

            // Generate overall progress summary
            overallProgress.innerHTML = `
                <div style="background: #E3F2FD; padding: 12px; border-radius: 6px; margin-bottom: 8px;">
                    <div style="font-size: 14px; font-weight: 500; margin-bottom: 8px;">Overall Progress: ${completedRuns.length}/56 runs completed (${overallCompletion}%)</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${overallCompletion}%"></div>
                    </div>
                </div>
            `;

            const phaseInfo = {
                1: { name: 'Rebuild Base', class: 'phase-1' },
                2: { name: 'Rebuild Base', class: 'phase-1' },
                3: { name: 'Rebuild Base', class: 'phase-1' },
                4: { name: 'Rebuild Base', class: 'phase-1' },
                5: { name: 'Build Endurance', class: 'phase-2' },
                6: { name: 'Build Endurance', class: 'phase-2' },
                7: { name: 'Build Endurance', class: 'phase-2' },
                8: { name: 'Build Endurance', class: 'phase-2' },
                9: { name: 'Build Endurance', class: 'phase-2' },
                10: { name: 'Race Sharpening', class: 'phase-3' },
                11: { name: 'Race Sharpening', class: 'phase-3' },
                12: { name: 'Race Sharpening', class: 'phase-3' },
                13: { name: 'Race Sharpening', class: 'phase-3' },
                14: { name: 'Taper Week', class: 'phase-4' }
            };

            // Helper function to get week start date
            function getWeekStartDate(week) {
                const start = new Date(START_DATE);
                start.setDate(start.getDate() + (week - 1) * 7);
                return start;
            }

            // Helper function to get date for specific day in week
            function getDateForDay(week, dayName) {
                const weekStart = getWeekStartDate(week);
                const dayMap = { 'Monday': 1, 'Wednesday': 3, 'Friday': 5, 'Saturday': 6, 'Sunday': 0 };
                const targetDay = dayMap[dayName];

                const date = new Date(weekStart);
                const currentDay = date.getDay();
                let daysToAdd = targetDay - currentDay;
                if (daysToAdd < 0) daysToAdd += 7;
                date.setDate(date.getDate() + daysToAdd);

                return date.toISOString().split('T')[0];
            }

            let html = '';
            for (let week = 1; week <= 14; week++) {
                const phase = phaseInfo[week];
                const isCurrent = week === currentWeek;
                const weekPlan = TRAINING_PLAN[week];

                // Calculate week completion
                const weekRuns = runs.filter(r => r.week === week);
                const completedRuns = weekRuns.filter(r => r.completed);
                const completionPercent = Math.round((completedRuns.length / weekPlan.length) * 100);

                let completionClass = 'none';
                let completionText = `0/${weekPlan.length} completed`;

                if (completedRuns.length > 0) {
                    completionClass = completedRuns.length === weekPlan.length ? 'complete' : 'partial';
                    completionText = `${completedRuns.length}/${weekPlan.length} completed`;
                }

                html += `
                    <div class="week-accordion">
                        <div class="week-header ${isCurrent ? 'current' : ''}" onclick="toggleWeek(${week})">
                            <div>
                                <div class="week-title">
                                    Week ${week}
                                    <span class="phase-badge ${phase.class}">${phase.name}</span>
                                </div>
                                <div class="week-subtitle">${weekPlan.length} runs scheduled</div>
                                <div class="week-completion ${completionClass}">${completionText}</div>
                            </div>
                            <div class="week-arrow" id="arrow-${week}">‚ñ∂</div>
                        </div>
                        <div class="week-content" id="content-${week}">
                `;

                weekPlan.forEach(plannedRun => {
                    // Find matching logged run for this day
                    const expectedDate = getDateForDay(week, plannedRun.day);
                    const loggedRun = runs.find(r =>
                        r.date === expectedDate && r.week === week
                    );

                    let statusClass = '';
                    let statusIcon = '';
                    let actualPaceHTML = '';

                    if (loggedRun) {
                        if (loggedRun.completed) {
                            statusClass = 'completed';
                            statusIcon = '‚úÖ';
                            actualPaceHTML = `<div class="actual-pace">Actual: ${loggedRun.distance}km in ${loggedRun.duration} min (${formatPace(loggedRun.pace)}/km)</div>`;
                        } else {
                            statusClass = 'missed';
                            statusIcon = '‚ùå';
                        }
                    }

                    html += `
                        <div class="plan-run-item ${statusClass}">
                            <div class="plan-day">
                                <span>${plannedRun.day}</span>
                                <span class="run-status">${statusIcon}</span>
                            </div>
                            <div class="plan-workout">${plannedRun.workout}</div>
                            <div class="plan-pace">Target Pace: ${plannedRun.targetPace}</div>
                            ${actualPaceHTML}
                        </div>
                    `;
                });

                html += `
                        </div>
                    </div>
                `;
            }

            planAccordion.innerHTML = html;

            // Auto-expand current week
            if (currentWeek >= 1 && currentWeek <= 14) {
                setTimeout(() => toggleWeek(currentWeek), 100);
            }
        }

        function toggleWeek(week) {
            const content = document.getElementById(`content-${week}`);
            const arrow = document.getElementById(`arrow-${week}`);

            if (content.classList.contains('visible')) {
                content.classList.remove('visible');
                arrow.classList.remove('expanded');
            } else {
                content.classList.add('visible');
                arrow.classList.add('expanded');
            }
        }

        function updateAnalytics() {
            const runs = JSON.parse(localStorage.getItem('runs') || '[]');
            const completedRuns = runs.filter(r => r.completed);

            if (completedRuns.length === 0) {
                // Show empty states
                document.getElementById('fastest-pace').textContent = '--';
                document.getElementById('slowest-pace').textContent = '--';
                document.getElementById('total-distance-analytics').textContent = '0';
                document.getElementById('total-time-analytics').textContent = '0';
                return;
            }

            // Calculate summary stats
            const paces = completedRuns.map(r => r.pace).filter(p => p > 0);
            const fastestPace = Math.min(...paces);
            const slowestPace = Math.max(...paces);
            const totalDistance = completedRuns.reduce((sum, r) => sum + (r.distance || 0), 0);
            const totalTime = completedRuns.reduce((sum, r) => sum + (r.duration || 0), 0);

            document.getElementById('fastest-pace').textContent = formatPace(fastestPace);
            document.getElementById('slowest-pace').textContent = formatPace(slowestPace);
            document.getElementById('total-distance-analytics').textContent = totalDistance.toFixed(1);
            document.getElementById('total-time-analytics').textContent = Math.round(totalTime);

            // Generate charts
            generatePaceTrendChart(completedRuns);
            generateWeeklyVolumeChart(completedRuns);
            generateWeeklyRunsChart(runs);
        }

        function generatePaceTrendChart(completedRuns) {
            const container = document.getElementById('pace-trend-chart');

            if (completedRuns.length < 2) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìà</div>
                        <div style="font-size: 14px;">Complete at least 2 runs to see pace trends</div>
                    </div>
                `;
                return;
            }

            // Get last 10 runs
            const recentRuns = completedRuns
                .sort((a, b) => new Date(a.date) - new Date(b.date))
                .slice(-10);

            // Find min and max pace for scaling
            const paces = recentRuns.map(r => r.pace);
            const minPace = Math.min(...paces);
            const maxPace = Math.max(...paces);
            const paceRange = maxPace - minPace || 60; // Default range if all same

            // Create SVG line chart
            const width = 100; // percentage
            const height = 180;
            const padding = 20;

            const points = recentRuns.map((run, index) => {
                const x = padding + ((index / (recentRuns.length - 1)) * (width - 2 * padding));
                const normalizedPace = (run.pace - minPace) / paceRange;
                const y = height - padding - (normalizedPace * (height - 2 * padding));
                return `${x},${y}`;
            }).join(' ');

            const svg = `
                <svg class="line-chart-svg" viewBox="0 0 ${width} ${height}" preserveAspectRatio="none">
                    <polyline
                        points="${points}"
                        fill="none"
                        stroke="#1976D2"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                    />
                    ${recentRuns.map((run, index) => {
                        const x = padding + ((index / (recentRuns.length - 1)) * (width - 2 * padding));
                        const normalizedPace = (run.pace - minPace) / paceRange;
                        const y = height - padding - (normalizedPace * (height - 2 * padding));
                        return `<circle cx="${x}" cy="${y}" r="2" fill="#1976D2"/>`;
                    }).join('')}
                </svg>
                <div style="display: flex; justify-content: space-between; margin-top: 8px; font-size: 10px; color: #757575;">
                    <span>Oldest</span>
                    <span>Latest</span>
                </div>
                <div style="text-align: center; margin-top: 8px; font-size: 11px; color: #1976D2;">
                    Range: ${formatPace(minPace)} - ${formatPace(maxPace)} /km
                </div>
            `;

            container.innerHTML = svg;
        }

        function generateWeeklyVolumeChart(completedRuns) {
            const container = document.getElementById('weekly-volume-chart');

            if (completedRuns.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìä</div>
                        <div style="font-size: 14px;">Start logging runs to see weekly volume</div>
                    </div>
                `;
                return;
            }

            // Calculate weekly volumes
            const weeklyData = {};
            for (let week = 1; week <= 14; week++) {
                weeklyData[week] = 0;
            }

            completedRuns.forEach(run => {
                if (run.week >= 1 && run.week <= 14) {
                    weeklyData[run.week] += run.distance || 0;
                }
            });

            // Find max volume for scaling
            const maxVolume = Math.max(...Object.values(weeklyData));

            // Generate bars
            const currentWeek = getCurrentWeek();
            const bars = [];
            for (let week = 1; week <= currentWeek; week++) {
                const volume = weeklyData[week];
                const heightPercent = maxVolume > 0 ? (volume / maxVolume) * 100 : 0;

                bars.push(`
                    <div class="bar-item">
                        <div class="bar-value">${volume.toFixed(1)}</div>
                        <div class="bar" style="height: ${heightPercent}%"></div>
                        <div class="bar-label">W${week}</div>
                    </div>
                `);
            }

            container.innerHTML = bars.join('');
        }

        function generateWeeklyRunsChart(allRuns) {
            const container = document.getElementById('weekly-runs-chart');

            if (allRuns.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üèÉ‚Äç‚ôÇÔ∏è</div>
                        <div style="font-size: 14px;">Start logging runs to see weekly counts</div>
                    </div>
                `;
                return;
            }

            // Calculate weekly run counts
            const weeklyData = {};
            for (let week = 1; week <= 14; week++) {
                weeklyData[week] = { completed: 0, total: 0 };
            }

            allRuns.forEach(run => {
                if (run.week >= 1 && run.week <= 14) {
                    weeklyData[run.week].total++;
                    if (run.completed) {
                        weeklyData[run.week].completed++;
                    }
                }
            });

            // Find max count for scaling
            const maxCount = Math.max(...Object.values(weeklyData).map(d => d.total));

            // Generate bars
            const currentWeek = getCurrentWeek();
            const bars = [];
            for (let week = 1; week <= currentWeek; week++) {
                const data = weeklyData[week];
                const heightPercent = maxCount > 0 ? (data.completed / 4) * 100 : 0; // Out of 4 scheduled

                bars.push(`
                    <div class="bar-item">
                        <div class="bar-value">${data.completed}/4</div>
                        <div class="bar" style="height: ${heightPercent}%"></div>
                        <div class="bar-label">W${week}</div>
                    </div>
                `);
            }

            container.innerHTML = bars.join('');
        }

        // Register service worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js').then(function(registration) {
                console.log('Service Worker registered with scope:', registration.scope);
            }).catch(function(error) {
                console.log('Service Worker registration failed:', error);
            });
        }
    </script>
</body>
</html>
